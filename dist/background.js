!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}({0:function(e,t,n){"use strict";n.d(t,"h",function(){return r}),n.d(t,"b",function(){return a}),n.d(t,"c",function(){return i}),n.d(t,"d",function(){return o}),n.d(t,"e",function(){return s}),n.d(t,"g",function(){return u}),n.d(t,"a",function(){return c}),n.d(t,"f",function(){return l});const r="user",a="displayname",i="https://graphigo.prd.dlive.tv/",o="https://dlive.tv/",s="/login",u="/streams",c="/about",l={UPDATE_USER_INFO:"UPDATE_USER_INFO",UPDATE_LIVE_STREAMS:"UPDATE_LIVE_STREAMS"}},1:function(e,t,n){"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(){var t=this;a(this,e),this.interceptors=[],this.fetch=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.interceptorWrapper.apply(t,[fetch].concat(n))}}return r(e,[{key:"addInterceptors",value:function(e){var t=this,n=[];return Array.isArray(e)?e.map(function(e){return n.push(t.interceptors.length),t.interceptors.push(e)}):e instanceof Object&&(n.push(this.interceptors.length),this.interceptors.push(e)),this.updateInterceptors(),function(){return t.removeInterceptors(n)}}},{key:"removeInterceptors",value:function(e){var t=this;Array.isArray(e)&&(e.map(function(e){return t.interceptors.splice(e,1)}),this.updateInterceptors())}},{key:"updateInterceptors",value:function(){this.reversedInterceptors=this.interceptors.reduce(function(e,t){return[t].concat(e)},[])}},{key:"clearInterceptors",value:function(){this.interceptors=[],this.updateInterceptors()}},{key:"interceptorWrapper",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=Promise.resolve(n);return this.reversedInterceptors.forEach(function(e){var t=e.request,r=e.requestError;(t||r)&&(a=a.then(function(){return t.apply(void 0,n)},r))}),a=a.then(function(){return e.apply(void 0,n)}),this.reversedInterceptors.forEach(function(e){var t=e.response,n=e.responseError;(t||n)&&(a=a.then(t,n))}),a}}]),e}(),o=function(e){function t(e){var n=e.url,r=e.interceptors,i=e.headers,o=e.onStart,s=e.onEnd,u=e.omitEmptyVariables,c=void 0!==u&&u,l=e.requestOptions,f=void 0===l?{}:l;a(this,t);var p=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return p.requestObject=Object.assign({},{method:"POST",headers:Object.assign({},{Accept:"application/json","Content-Type":"application/json"},i),credentials:"same-origin"},f),p.url=n,p.omitEmptyVariables=c,p.requestQueueLength=0,p.EnumMap={},p.callbacks={onStart:o,onEnd:s},p.addInterceptors(r),p}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i),r(t,[{key:"query",value:function(e){var t=this,n=e.operationName,r=e.query,a=e.variables,i=e.opts,o=void 0===i?{}:i,s=e.requestOptions,u=void 0===s?{}:s,c=Object.assign({},this.requestObject,u),l={operationName:n,query:r,variables:this.omitEmptyVariables||o.omitEmptyVariables?this.doOmitEmptyVariables(a):a};return c.body=JSON.stringify(l),this.onStart(),this.fetch(this.url,c).then(function(e){return e.ok?e.json():{errors:[{message:e.statusText,stack:e}]}}).then(function(e){var n=e.data,r=e.errors;return new Promise(function(e,a){return t.onEnd(),n?Object.keys(n).every(function(e){return!n[e]})?a(r):e({data:n,errors:r}):a(r||[{}])})})}},{key:"getUrl",value:function(){return this.url}},{key:"setUrl",value:function(e){this.url=e}},{key:"getEnumTypes",value:function(e){var t=this,n={},r=e.filter(function(e){return!t.EnumMap[e]||(n[e]=t.EnumMap[e],!1)});if(!r.length)return new Promise(function(e){e({data:n})});var a="\n      query {\n        "+r.map(function(e){return e+': __type(name: "'+e+'") {\n        ...EnumFragment\n      }'}).join("\n")+"\n      }\n      \n      fragment EnumFragment on __Type {\n        kind\n        description\n        enumValues {\n          name\n          description\n        }\n      }",i=Object.assign({},this.requestObject);return i.body=JSON.stringify({query:a}),this.onStart(),this.fetch(this.url,i).then(function(e){return e.ok?e.json():{errors:[{message:e.statusText,stack:e}]}}).then(function(e){var r=e.data,a=e.errors;return new Promise(function(e,i){if(t.onEnd(),!r)return i(a||[{message:"Do not get any data."}]);if(Object.keys(r).every(function(e){return!r[e]})&&a&&a.length)return i(a);var o=Object.assign(n,r);return Object.keys(r).map(function(e){return t.EnumMap[e]=r[e],e}),e({data:o,errors:a})})})}},{key:"onStart",value:function(){this.requestQueueLength++,this.requestQueueLength>1||!this.callbacks.onStart||this.callbacks.onStart(this.requestQueueLength)}},{key:"onEnd",value:function(){this.requestQueueLength--,!this.requestQueueLength&&this.callbacks.onEnd&&this.callbacks.onEnd(this.requestQueueLength)}},{key:"doOmitEmptyVariables",value:function(e){var t=this,n={};return Object.keys(e).map(function(r){var a=e[r];return"string"==typeof a&&0===a.length||null==a?r:(a instanceof Object?n[r]=t.doOmitEmptyVariables(a):n[r]=a,r)}),n}}]),t}();t.a=o},10:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n(0);const i="\nquery LivestreamPage($displayname: String!, $first: Int, $after: String) {\n  userByDisplayName (displayname: $displayname) {\n    displayname\n    avatar\n    id\n    username\n    livestream {\n      id\n      permlink\n    }\n    \n    following (\n      sortedBy: AZ \n      first: $first,\n      after: $after\n    ) {\n      pageInfo {\n        endCursor\n        hasNextPage\n      }\n      list {\n        avatar\n        displayname\n        partnerStatus\n        id\n        username\n        displayname\n        livestream {\n          id\n          permlink\n          title\n          thumbnailUrl\n          watchingCount\n          category {\n            title\n          }\n        }\n        followers {\n          totalCount\n        }\n      }\n    }\n  }\n}",o="\nquery LivestreamPage($displayname: String!, $first: Int, $after: String) {\n  userByDisplayName (displayname: $displayname) {\n    displayname\n    following (\n      sortedBy: AZ \n      first: $first,\n      after: $after\n    ) {\n      pageInfo {\n        endCursor\n        hasNextPage\n      }\n      list {\n        avatar\n        displayname\n        partnerStatus\n        id\n        username\n        displayname\n        livestream {\n          id\n          permlink\n          title\n          thumbnailUrl\n          watchingCount\n          category {\n            title\n          }\n        }\n        followers {\n          totalCount\n        }\n      }\n    }\n  }\n}",s=20;function u(){return new r.a({url:a.c})}function c(e){let t=JSON.parse(localStorage.getItem(a.h));if(!t)return Promise.reject(t);let n=e.data.userByDisplayName.following;return n?(t.following.list=t.following.list.concat(n.list),localStorage.setItem(a.h,JSON.stringify(t)),Promise.resolve(e)):Promise.reject(n)}function l(e){let t=e.data.userByDisplayName;var n,r,a;t&&(t.following.pageInfo.hasNextPage&&(n=t.displayname,r=s,a=t.following.pageInfo.endCursor,u().query({operationName:"LivestreamPage",variables:{displayname:n,first:r,after:a},query:o}).then(c).then(l)))}chrome.runtime.onMessage.addListener(function(e,t,n){switch(e.kind){case a.f.UPDATE_USER_INFO:!function(e){let t=localStorage.getItem(a.b);if(t)return new Promise((e,n)=>{u().query({operationName:"LivestreamPage",variables:{displayname:t,first:s},query:i}).then(t=>{let r=t.data.userByDisplayName;if(!r)return n("User could not be fetched");localStorage.setItem(a.h,JSON.stringify(r)),r.following.pageInfo.hasNextPage||e(r),l(t).then(()=>{e(localStorage.getItem(a.h))})})}).finally(e);e("No displayname in storage.")}(n);break;case a.f.UPDATE_LIVE_STREAMS:!function(e){e("unimplemented feature")}(n);break;default:return!1}return!0})}});